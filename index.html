<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Toasty Chat</title>
    <script src="https://cdn.socket.io/4.1.3/socket.io.min.js"></script>
    <script src="./bootstrap.js"></script>
    <link href="./bootstrap.css" rel="stylesheet" />
    <script type="module">
        import { readConfigFile } from './readConfig_browser.js';

        async function initializeSocket() {
            const config = await readConfigFile('botinfo.txt');
            const socket = io(`${config.server}:${config['socket-port']}`);

            socket.on('toastify', (toastData) => {
                // Handle the received "toastify" data
                //console.log('Received toastify data:', toastData);
                // Create a new toast using the received data
                const objToastData = JSON.parse(toastData);
                createToast(objToastData);
            });
        }

function createToast(toastData) {
  // Create toast element
    console.log(typeof toastData);
  const toastElement = document.createElement('div');
  toastElement.classList.add('toast');
  toastElement.setAttribute('role', 'alert');
  toastElement.setAttribute('aria-live', 'assertive');
  toastElement.setAttribute('aria-atomic', 'true');
  toastElement.setAttribute('data-bs-delay', '60000');

  // Create toast header
  const toastHeader = document.createElement('div');
  toastHeader.classList.add('toast-header', 'fs-4');
  toastHeader.style.backgroundColor = toastData.colour;

  // Avatar
  const avatarImg = document.createElement('img');
  avatarImg.classList.add('rounded', 'me-2', 'avatar');
  avatarImg.setAttribute('height','50px');
  avatarImg.src = toastData.profilePictureUrl; // Corrected property name
  avatarImg.alt = '...';
  toastHeader.appendChild(avatarImg);

  // Username
  const username = document.createElement('strong');
  username.classList.add('me-auto', 'username');
  username.textContent = toastData.username;
  toastHeader.appendChild(username);

  // Time
  const time = document.createElement('small');
  time.classList.add('text-body-secondary', 'time');
  time.textContent = formatTime(new Date());
  toastHeader.appendChild(time);

  toastElement.appendChild(toastHeader);

  // Toast body
  const toastBody = document.createElement('div');
  toastBody.classList.add('toast-body', 'fs-2');
  toastBody.textContent = toastData.message;
  toastElement.appendChild(toastBody);

  // Add the toast to the container
  const toastContainer = document.querySelector('.toast-container');
  toastContainer.appendChild(toastElement);

  // Initialize Bootstrap Toast instance
  const toastInstance = new bootstrap.Toast(toastElement);
  toastInstance.show();
}

// Example usage:
const exampleToastData = {
  username: "Abraxas86",
  colour: "#B22222",
  message: "asdf",
  emotes: "",
  profilePictureUrl: "https://static-cdn.jtvnw.net/jtv_user_pictures/18c443db-a3ee-4eef-80b2-bab1b3845cd6-profile_image-300x300.png"
};

createToast(exampleToastData);

// Function to format time to HH:mm:ss
function formatTime(date) {
  return date.getHours().toString().padStart(2, '0') + ':' +
         date.getMinutes().toString().padStart(2, '0') + ':' +
         date.getSeconds().toString().padStart(2, '0');
}


        initializeSocket();

    </script>
</head>
<body>
    <div class="toast-container position-static">
        <div class="toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <img src="" class="rounded me-2 avatar" alt="...">
                <strong class="me-auto username"></strong>
                <small class="text-body-secondary time"></small>
            </div>
            <div class="toast-body message"></div>
        </div>
    </div>
</body>
</html>
